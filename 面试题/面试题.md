面试题

1.epoll水平触发和边缘触发使用场景

1. epoll默认是水平触发（LT）

2. LT通俗来说 只要缓冲区有数据 epoll wait函数就一直返回；边缘触发来讲 只有socket状态发生变化，epoll_wait函数才会返回。

3. 水平触发优缺点及应用场景：

   1. 优点：当socket进行通信时，保证了数据的完整性，**进行IO操作的时候，如果还有数据，就会一直的通知你**。
   2. 缺点：由于只要还有数据，内核就会不停的从内核空间转到用户空间，**所以占用了大量的内核资源，试想一下当有大量数据到来的时候，每次读取一个字节，这样就会不停的进行切换。内核资源的浪费严重。**效率来讲也是很低的。
   3. 应用场景

4. 边沿触发优、缺点及应用场景：

   优点：每次内核只会通知一次，大大减少了内核资源的浪费，提高效率。

   缺点：不能保证数据的完整。不能及时的取出所有的数据。

   应用场景：处理大数据。使用non-block模式的socket。

水平触发（LT）：读缓冲区非空就会一直触发，写缓冲区只要不满就会一直触发写事件。
边缘触发（ET）：读缓冲区空转非空（有新消息）的时候触发一次，写缓冲区从满到非满的时候（空出来可以写了）触发一次。



总结：

如果我们用水平触发不用担心数据有没有读完因为下次epoll返回时，没有读完的socket依然会被返回，但是要注意这种模式下的写事件，因为是水平触发，每次socket可写时epoll都会返回，，当我们写的数据包过大时，一次写不完，要多次才能写完或者每次socket写都写一个很小的数据包时，每次写都会被epoll检测到，因此**长期关注socket写事件会无故cpu消耗过大甚至导致cpu跑满**，所以**在水平触发模式下我们一般不关注可写事件**，而是通过调用socket write或者send api函数来写socket，说到这我们可以看到这种模式在效率上是没有边缘触发高的，因为每个socket读或者写可能被返回两次或者多次。

所以有时候我们也会用到边缘触发，但是这种模式下在读数据的时候一定要注意，因为如果一次可读事件我们没有把数据读完，如果没有读完，在socket没有新的数据可读时epoll就不回返回了，只有在新的数据到来时，我们才能读取到上次没有读完的数据。





个人看法：

对于读事件：如果业务可以保证每次都可以读完，那就可以使用ET，否则使用LT

对于写事件：如果一次性可以写完那就可以使用LT，写完删除写事件就可以了.

但是如果写的数据很大也不在意延迟，那么就可以使用ET，因为ET可以保证在发送缓冲区变为空时才再次通知（而LT则是发送缓冲区空了就可以通知就绪，这样就每次触发就只能写一点点数据，内核切换开销以及内存拷贝开销过大）

操作系统内存管理





6.8大小的水果袋，给定m个水果，要求正好装满袋子，返回6、8大小袋子的数量，如果不能正好装满都返回0。用的DP做的